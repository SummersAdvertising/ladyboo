<script src="/js_plugins/chart/Chart.js"></script>
<style type="text/css">
  table {
    width: 100%;
    text-align: center;
  }
  table, th, td {
   border: 1px solid black;
  }
  canvas {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
    width: 800px;
  }
</style>
DailyReport - show<br>
<% unless @revenue_details[0] == true || @revenue_details[1] == true %>
  <br>= top 10 in category today<br>
  <% @revenue_details[2].each do |record| %>
    <%= record[0] %> => <%= record[1] %> <%= "#{((record[1].to_f/@product_revenue_amount)*100).round(3)} %" if @product_revenue_amount > 0 %><br>
  <% end %>
  <canvas id="myChartByCategory">
    <script>
      // Chart.defaults.global.responsive = true;
      var data_by_category = <%= @chart_data_array[0].to_json.html_safe %>;
      // Get the context of the canvas element we want to select
      var ctx = document.getElementById("myChartByCategory").getContext("2d");
      var myNewChart = new Chart(ctx).Doughnut(data_by_category);
    </script>
  </canvas><!--canvas-1 end-->

  <br>= top 10 in product today<br>
  <% @revenue_details[3].each do |record| %>
    <%= record[0][0] %> - <%= record[0][1] %> => <%= record[1] %> <%= "#{((record[1].to_f/@product_revenue_amount)*100).round(3)} %" if @product_revenue_amount > 0 %><br>
  <% end %>  
  <canvas id="myChartByProduct">
    <script>
      // Chart.defaults.global.responsive = true;
      var data_by_product = <%= @chart_data_array[1].to_json.html_safe %>;
      // Get the context of the canvas element we want to select
      var ctx = document.getElementById("myChartByProduct").getContext("2d");
      var myNewChart = new Chart(ctx).Doughnut(data_by_product);
    </script>
  </canvas><!--canvas-2 end-->

  <br>= top 10 in stock today<br>
  <% @revenue_details[4].each do |record| %>
    <%= record[0][3] %> => <%= record[1] %> <%= "#{((record[1].to_f/@product_revenue_amount)*100).round(3)} %" if @product_revenue_amount > 0 %><br>
  <% end %>
  <canvas id="myChartByStock">
    <script>
      // Chart.defaults.global.responsive = true;
      var data_by_stock = <%= @chart_data_array[2].to_json.html_safe %>;
      // Get the context of the canvas element we want to select
      var ctx = document.getElementById("myChartByStock").getContext("2d");
      var myNewChart = new Chart(ctx).Doughnut(data_by_stock);
    </script>
  </canvas><!--canvas-3 end-->
  
<% end %>
<hr>

<% unless @daily_report.blank? %>
= latest report<br>
日期:<%= @daily_report.name %><br>
訂單總數:<%= @daily_report.total_order_count %><br>
成功下單:<%= @daily_report.valid_order_count %><br>
最後確認前離開:<%= @daily_report.onhold_order_count %><br>
完成訂單數:<%= @daily_report.completed_order_count %><br>
取消訂單數:<%= @daily_report.cancel_order_count %><br>
人為處理完成:<%= @daily_report.abnormal_end_order_count %><br>
新會員:<%= @daily_report.new_member_count %><br>
運費營業額:<%= @daily_report.total_shipping_revenue %><br>
產品營業額:<%= @daily_report.total_product_revenue %><br>
總營業額:<%= @daily_report.total_revenue %><br>

  <% unless @daily_report.total_order_count == 0 || @daily_report.total_order_count.blank? %>
    <br>= other calculation<br>
    成功下單率:<%= (@daily_report.valid_order_count.to_f / @daily_report.total_order_count).round(2)*100 %>％<br>
    跳出:<%= (@daily_report.onhold_order_count.to_f / @daily_report.total_order_count).round(2)*100 %>％<br>
  <% end %>
<% end %>
<hr>

<% unless @sumup_by_category.blank? %>
= Sales by category<br>
Total amount: <%= @daily_report.sum_it_up('ByCategory') %><br>
List_by_type:<br>
<% @daily_report.list_by_type('ByCategory').each do |record| %>
  <%= "#{record.category_name} >> " if record.category_name %>
  <%= "#{record.product_name} >> " if record.product_name %>
  <%= "#{record.stock_name}" if record.stock_name %><br>
  [<%= record.context_displayname %> => <%= record.figure %>]<br><br>
<% end %>
<hr>
<% end %>

<% unless @sumup_by_product.blank? %>
= Sales by product<br>
Total amount: <%= @daily_report.sum_it_up('ByProduct') %><br>
List_by_type:<br>
<% @daily_report.list_by_type('ByProduct').each do |record| %>
  <%= "#{record.category_name} >> " if record.category_name %>
  <%= "#{record.product_name} >> " if record.product_name %>
  <%= "#{record.stock_name}" if record.stock_name %><br>
  [<%= record.context_displayname %> => <%= record.figure %>]<br><br>
<% end %>
<hr>
<% end %>

<% unless @sumup_by_stock.blank? %>
= Sales by stock<br>
Total amount: <%= @daily_report.sum_it_up('ByStock') %><br>
List_by_type:<br>
<% @daily_report.list_by_type('ByStock').each do |record| %>
  <%= "#{record.category_name} >> " if record.category_name %>
  <%= "#{record.product_name} >> " if record.product_name %>
  <%= "#{record.stock_name}" if record.stock_name %><br>
  [<%= record.context_displayname %> => <%= record.figure %>]<br><br>
<% end %>

<hr>
<% end %>